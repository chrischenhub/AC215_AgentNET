x-agentnet-image: &agentnet-image ${AGENTNET_IMAGE:-agentnet-cli}:${AGENTNET_IMAGE_TAG:-latest}
x-agentnet-base: &agentnet-base
  image: *agentnet-image
  platform: ${AGENTNET_PLATFORM:-linux/amd64}
  working_dir: /app
  volumes:
    - ./:/app
  entrypoint: ["/usr/local/bin/docker-entrypoint.sh"]
  tty: true
  stdin_open: true

services:
  agentnet:
    <<: *agentnet-base
    build:
      context: .
    env_file:
      - .env
    volumes:
      - ./:/app
      - ./DB/chroma_store:/app/DB/chroma_store
    ports:
      - "${AGENTNET_WEB_PORT:-8000}:8000"
    environment:
      PORT: 8000
      PYTHONPATH: /app
    command:
      [
        "uvicorn",
        "app:app",
        "--host",
        "0.0.0.0",
        "--port",
        "8000",
        "--reload",
        "--app-dir",
        "src/models",
      ]
    restart: unless-stopped

  notion-agent:
    <<: *agentnet-base
    build:
      context: .
    env_file:
      - .env
    profiles: ["notion"]
    command: ["python", "notion_agent.py", "--help"]
